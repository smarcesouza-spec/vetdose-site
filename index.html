<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VetDose ‚Ä¢ Calculadora Veterin√°ria</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 460px;
  margin: 40px auto;
  background: #ffffff;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 10px 25px rgba(0,0,0,.06);
}

h1 {
  text-align: center;
  margin-bottom: 8px;
}

.subtitle {
  text-align: center;
  font-size: 14px;
  color: #666;
  margin-bottom: 20px;
}

label {
  display: block;
  margin-top: 12px;
  font-size: 14px;
  font-weight: 600;
}

input, select {
  width: 100%;
  padding: 9px 10px;
  margin-top: 4px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}

button {
  width: 100%;
  margin-top: 20px;
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: #5469d4;
  color: white;
  font-weight: 600;
  cursor: pointer;
}

button:hover {
  opacity: .9;
}

.box {
  margin-top: 16px;
  background: #f0f2fa;
  border-radius: 8px;
  padding: 14px;
  font-size: 14px;
}

.error {
  background: #ffe1e1;
  color: #b40000;
}

.success {
  background: #e4f8ec;
  color: #046832;
}

.small {
  font-size: 11px;
  margin-top: 12px;
  color: #888;
  text-align: center;
}
</style>
</head>

<body>

<div class="container">
  <h1>VetDose</h1>
  <div class="subtitle">Calculadora Inteligente de Dosagem Veterin√°ria</div>

  <form id="form">
    
    <label>Email profissional</label>
    <input type="email" name="email" required />

    <label>API Key</label>
    <input type="password" name="apiKey" required />

    <label>Esp√©cie</label>
    <select name="species" required>
      <option value="dog">C√£o</option>
      <option value="cat">Gato</option>
    </select>

    <label>Ra√ßa</label>
    <input name="breed" placeholder="Ex: SRD, Shih-tzu" />

    <label>Peso</label>
    <input type="number" name="weight" step="0.1" placeholder="Ex: 8" required />

    <label>Unidade</label>
    <select name="unit">
      <option value="kg">kg</option>
      <option value="g">g</option>
      <option value="lb">lb</option>
    </select>

    <label>Medicamento</label>
    <input name="medication_id" placeholder="Ex: amox-500" required />

    <label>Condi√ß√£o cl√≠nica (opcional)</label>
    <input name="condition" placeholder="Ex: renal, gesta√ß√£o..." />

    <button>Calcular dose</button>

  </form>

  <div id="msg" class="box" style="display:none;"></div>

  <div class="small">
    Ferramenta de apoio cl√≠nico. A decis√£o √© sempre do m√©dico-veterin√°rio respons√°vel.
  </div>

</div>

<script>
const form = document.getElementById("form");
const msgBox = document.getElementById("msg");

form.addEventListener("submit", async e => {
  e.preventDefault();
  msgBox.style.display = "block";
  msgBox.className = "box";
  msgBox.innerHTML = "Calculando...";

  const data = new FormData(form);

  const payload = {
    auth: {
      email: data.get("email"),
      apiKey: data.get("apiKey")
    },
    patient: {
      species: data.get("species"),
      breed: data.get("breed")
    },
    weight: {
      value: Number(data.get("weight")),
      unit: data.get("unit")
    },
    medication_id: data.get("medication_id"),
    context: {
      condition: data.get("condition")
    }
  };

  try {
    const res = await fetch("https://weakdamselfish-n8n.cloudfy.live/webhook/vet-dose", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const json = await res.json();

    if (!json.success) {
      msgBox.classList.add("error");
      msgBox.innerHTML = "‚ùå " + json.error;
      return;
    }

    msgBox.classList.add("success");
    msgBox.innerHTML = `
      <strong>Dose calculada com sucesso</strong><br><br>
      ‚öñÔ∏è Peso: ${json.weight_kg} kg<br>
      üíä Medicamento: ${json.medication_id}<br>
      üìè Dose: <strong>${json.dose_mg} mg (${json.dose_ml} mL)</strong><br>
      ${json.interval ? `‚è±Ô∏è Intervalo: ${json.interval}<br>` : ""}
      <br>
      ‚úÖ ${json.message}
    `;

  } catch (err) {
    msgBox.classList.add("error");
    msgBox.innerHTML = "Erro ao conectar com o servidor.";
  }

});
</script>

</body>
</html>
